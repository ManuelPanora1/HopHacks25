<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Stock Market Hologram - Live Data & Sentiment</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
       
        body {
            background: radial-gradient(circle at center, #001122 0%, #000000 100%);
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }
       
        canvas {
            display: block;
        }
       
        #tooltip {
            position: fixed;
            background: linear-gradient(45deg, rgba(0,255,255,0.9), rgba(0,200,255,0.9));
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            display: none;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 20px rgba(0,255,255,0.3);
            backdrop-filter: blur(10px);
            max-width: 250px;
        }
       
        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ffff;
            font-size: 12px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(0,255,255,0.3);
        }
       
        #title {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #00ffff;
            font-size: 24px;
            font-weight: bold;
            z-index: 1000;
            text-shadow: 0 0 10px #00ffff;
        }

        #dataPanel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: #00ffff;
            font-size: 11px;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(0,255,255,0.3);
            min-width: 300px;
        }

        #marketHealth {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #00ffff;
            font-size: 18px;
            font-weight: bold;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(0,255,255,0.3);
            text-align: center;
        }

        #stockPanel {
            position: fixed;
            right: -350px;
            top: 0;
            width: 350px;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            color: #00ffff;
            z-index: 2000;
            padding: 20px;
            border-left: 2px solid rgba(0,255,255,0.5);
            backdrop-filter: blur(15px);
            transition: right 0.4s ease-in-out;
            overflow-y: auto;
        }

        #stockPanel.open {
            right: 0;
        }

        #togglePanel {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, rgba(0,255,255,0.8), rgba(0,150,255,0.8));
            color: white;
            border: none;
            padding: 15px 8px;
            border-radius: 8px 0 0 8px;
            cursor: pointer;
            z-index: 2001;
            font-size: 14px;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transition: all 0.3s ease;
        }

        #togglePanel:hover {
            background: linear-gradient(45deg, rgba(0,255,255,1), rgba(0,150,255,1));
            transform: translateY(-50%) translateX(-5px);
        }

        #stockPanel.open + #togglePanel {
            right: 370px;
            border-radius: 0 8px 8px 0;
        }

        .stock-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: rgba(0,255,255,0.1);
            border-radius: 6px;
            border: 1px solid rgba(0,255,255,0.3);
            transition: all 0.3s ease;
        }

        .stock-item:hover {
            background: rgba(0,255,255,0.2);
            transform: translateX(5px);
        }

        .stock-item.active {
            background: rgba(0,255,100,0.2);
            border-color: rgba(0,255,100,0.5);
        }

        .stock-toggle {
            width: 20px;
            height: 20px;
            border: 2px solid #00ffff;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .stock-toggle.checked {
            background: #00ff44;
            border-color: #00ff44;
        }

        .stock-toggle.checked::after {
            content: '‚úì';
            position: absolute;
            top: -2px;
            left: 2px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .add-stock-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(0,255,255,0.3);
                }

        .add-stock-input {
            width: 100%;
            padding: 10px;
            background: rgba(0,255,255,0.1);
            border: 1px solid rgba(0,255,255,0.5);
            border-radius: 4px;
            color: #00ffff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }

        .add-stock-input::placeholder {
            color: rgba(0,255,255,0.6);
        }

        .add-stock-btn {
            background: linear-gradient(45deg, rgba(0,255,100,0.8), rgba(0,200,150,0.8));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
        }

        .add-stock-btn:hover {
            background: linear-gradient(45deg, rgba(0,255,100,1), rgba(0,200,150,1));
            transform: translateY(-2px);
        }

        .stock-info {
            font-size: 12px;
            color: rgba(0,255,255,0.8);
        }

        .panel-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
        }

        .section-title {
            font-size: 14px;
            font-weight: bold;
            margin: 15px 0 10px 0;
            color: #00ff44;
        }

        .sentiment-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .positive { background: #00ff44; }
        .negative { background: #ff4400; }
        .neutral { background: #ffaa00; }

        .data-row {
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <div id="title">MARKET SENTIMENT HOLOGRAM</div>
    
    <div id="controls">
        <div>üñ±Ô∏è Move mouse to rotate</div>
        <div>üñ±Ô∏è Click to toggle auto-rotation</div>
        <div>üìä Hover for detailed analysis</div>
        <div>üîÑ Auto-updating every 10s</div>
    </div>

    <div id="marketHealth">
        <div id="overallSentiment">Market Sentiment: <span id="sentimentValue">NEUTRAL</span></div>
        <div style="font-size: 12px; margin-top: 5px;">Risk Level: <span id="riskLevel">MODERATE</span></div>
    </div>

    <div id="dataPanel">
        <div style="font-weight: bold; margin-bottom: 8px;">üìà Live Market Data</div>
        <div id="marketStats"></div>
        <div style="font-weight: bold; margin: 10px 0 5px 0;">üîç Recent Analysis</div>
        <div id="sentimentFeed" style="max-height: 120px; overflow-y: auto;"></div>
    </div>
    
    <div id="tooltip"></div>

    <!-- Stock Selection Panel -->
    <div id="stockPanel">
        <div class="panel-header">üìä STOCK SELECTOR</div>
    
        <div class="section-title">Active Stocks</div>
        <div id="stockList"></div>
    
        <div class="add-stock-section">
            <div class="section-title">Add New Stock</div>
            <input type="text" id="newStockSymbol" class="add-stock-input" placeholder="Enter stock symbol (e.g., AAPL)" maxlength="5">
            <button id="addStockBtn" class="add-stock-btn">Add to Visualization</button>
            <div style="font-size: 11px; color: rgba(0,255,255,0.6); margin-top: 10px; line-height: 1.4;">
                Note: New stocks will have simulated data for demonstration purposes.
            </div>
        </div>

        <div class="add-stock-section">
            <div class="section-title">Panel Controls</div>
            <button id="selectAllBtn" class="add-stock-btn" style="margin-bottom: 10px;">Select All Stocks</button>
            <button id="deselectAllBtn" class="add-stock-btn">Deselect All Stocks</button>
        </div>
    </div>

    <button id="togglePanel">STOCKS</button>    
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
   
    <script>
        // Enhanced stock data with sentiment analysis
        let allStocks = [
    { 
        name: 'AAPL', 
        change: 2.4, 
        price: 175.32, 
        volume: '45.2M',
        sentiment: { score: 0.7, sources: 15, trend: 'bullish' },
        volatility: 0.3,
        newsCount: 8,
        active: true
    },
    { 
        name: 'GOOGL', 
        change: -1.8, 
        price: 135.67, 
        volume: '28.1M',
        sentiment: { score: -0.3, sources: 12, trend: 'bearish' },
        volatility: 0.5,
        newsCount: 5,
        active: true
    },
    { 
        name: 'MSFT', 
        change: 1.2, 
        price: 342.89, 
        volume: '32.5M',
        sentiment: { score: 0.4, sources: 18, trend: 'bullish' },
        volatility: 0.2,
        newsCount: 12,
        active: true
    },
    { 
        name: 'TSLA', 
        change: -3.1, 
        price: 248.15, 
        volume: '67.8M',
        sentiment: { score: -0.8, sources: 25, trend: 'very_bearish' },
        volatility: 0.9,
        newsCount: 23,
        active: true
    },
    { 
        name: 'AMZN', 
        change: 0.8, 
        price: 142.78, 
        volume: '38.9M',
        sentiment: { score: 0.1, sources: 14, trend: 'neutral' },
        volatility: 0.4,
        newsCount: 7,
        active: true
    },
    { 
        name: 'META', 
        change: -2.2, 
        price: 298.45, 
        volume: '22.3M',
        sentiment: { score: -0.6, sources: 20, trend: 'bearish' },
        volatility: 0.7,
        newsCount: 15,
        active: true
    },
    { 
        name: 'NVDA', 
        change: 4.5, 
        price: 456.23, 
        volume: '89.1M',
        sentiment: { score: 0.9, sources: 30, trend: 'very_bullish' },
        volatility: 0.8,
        newsCount: 28,
        active: true
    },
    { 
        name: 'NFLX', 
        change: -1.1, 
        price: 378.92, 
        volume: '15.7M',
        sentiment: { score: -0.2, sources: 9, trend: 'neutral' },
        volatility: 0.3,
        newsCount: 4,
        active: true
    }
];

// Get active stocks for visualization
function getActiveStocks() {
    return allStocks.filter(stock => stock.active);
}

let stocks = getActiveStocks();
        // Global market metrics
        let marketData = {
            overallSentiment: 0.1,
            riskLevel: 0.5,
            volatilityIndex: 0.45,
            newsVolume: 102,
            socialMentions: 1543,
            lastUpdate: new Date()
        };

        // Setup Three.js
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0);
        document.body.appendChild(renderer.domElement);

        camera.position.z = 35;

        const clusters = [];
        const labels = [];
        const pulseRings = [];
        const mouse = new THREE.Vector2();
        const raycaster = new THREE.Raycaster();
        const tooltip = document.getElementById('tooltip');

        let mouseX = 0, mouseY = 0;
        let isRotating = true;
        let time = 0;

        // Create particle systems with enhanced sentiment visualization
        function createStockCluster(stock, index) {
            const particleCount = Math.floor(150 + stock.sentiment.sources * 3); // More particles for more sentiment data
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);
            
            // Color based on sentiment and price change
            let baseColor;
            if (stock.sentiment.score > 0.5) {
                baseColor = new THREE.Color(0, 1, 0.2); // Strong green for very positive
            } else if (stock.sentiment.score > 0) {
                baseColor = new THREE.Color(0, 0.8, 0.6); // Light green for positive  
            } else if (stock.sentiment.score > -0.5) {
                baseColor = new THREE.Color(0.8, 0.8, 0); // Yellow for neutral/mixed
            } else {
                baseColor = new THREE.Color(1, 0.2, 0); // Red for negative
            }
            
            for (let j = 0; j < particleCount; j++) {
                const i3 = j * 3;
                
                // Create distribution based on volatility
                const volatilityFactor = 1 + stock.volatility * 3;
                const radius = (Math.random() * 4 + 1) * volatilityFactor;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.random() * Math.PI;
                
                positions[i3] = radius * Math.sin(phi) * Math.cos(theta);
                positions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
                positions[i3 + 2] = radius * Math.cos(phi);
                
                // Color variation based on sentiment confidence
                const colorVariation = 0.3 * (1 - Math.abs(stock.sentiment.score));
                colors[i3] = Math.max(0, baseColor.r + (Math.random() - 0.5) * colorVariation);
                colors[i3 + 1] = Math.max(0, baseColor.g + (Math.random() - 0.5) * colorVariation);
                colors[i3 + 2] = Math.max(0, baseColor.b + (Math.random() - 0.5) * colorVariation);
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 2 + stock.volatility * 2, // Larger particles for higher volatility
                sizeAttenuation: false,
                transparent: true,
                opacity: 0.7 + Math.abs(stock.sentiment.score) * 0.3,
                vertexColors: true
            });
            
            // Enhanced glowing effect
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const context = canvas.getContext('2d');
            const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255,255,255,1)');
            gradient.addColorStop(0.3, 'rgba(255,255,255,0.8)');
            gradient.addColorStop(1, 'rgba(255,255,255,0)');
            context.fillStyle = gradient;
            context.fillRect(0, 0, 32, 32);
            
            const texture = new THREE.CanvasTexture(canvas);
            material.map = texture;
            
            const particles = new THREE.Points(geometry, material);
            particles.userData = {
                stock: stock,
                originalPositions: positions.slice(),
                index: index,
                pulseIntensity: stock.volatility
            };
            
            // Position based on sentiment (positive stocks higher, negative lower)
            const angle = (index / stocks.length) * Math.PI * 2;
            const radius = 20;
            particles.position.x = Math.cos(angle) * radius;
            particles.position.z = Math.sin(angle) * radius;
            particles.position.y = stock.sentiment.score * 8; // Vertical position based on sentiment
            
            scene.add(particles);
            
            // Add pulse ring for high volatility stocks
            if (stock.volatility > 0.6) {
                const ringGeometry = new THREE.RingGeometry(8, 9, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: stock.sentiment.score > 0 ? 0x00ff44 : 0xff4400,
                    transparent: true,
                    opacity: 0.3,
                    side: THREE.DoubleSide
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.position.copy(particles.position);
                ring.rotation.x = Math.PI / 2;
                scene.add(ring);
                pulseRings.push({ ring: ring, intensity: stock.volatility });
            }
            
            return particles;
        }

        // Create enhanced labels with sentiment indicators
        function createStockLabel(stock, position) {
            const canvas = document.createElement('canvas');
            canvas.width = 300;
            canvas.height = 100;
            const context = canvas.getContext('2d');
            
            // Background with sentiment-based color
            context.fillStyle = stock.sentiment.score > 0 ? 
                'rgba(0, 255, 68, 0.2)' : 
                stock.sentiment.score < 0 ? 'rgba(255, 68, 0, 0.2)' : 'rgba(255, 170, 0, 0.2)';
            context.fillRect(0, 0, 300, 100);
            
            // Main text
            context.fillStyle = stock.sentiment.score > 0 ? '#00ff44' : 
                               stock.sentiment.score < 0 ? '#ff4400' : '#ffaa00';
            context.font = 'bold 28px Courier New';
            context.textAlign = 'center';
            context.fillText(stock.name, 150, 35);
            
            // Price change
            context.font = 'bold 18px Courier New';
            context.fillText((stock.change > 0 ? '+' : '') + stock.change.toFixed(1) + '%', 150, 58);
            
            // Sentiment indicator
            context.font = '12px Courier New';
            const sentimentText = stock.sentiment.trend.toUpperCase().replace('_', ' ');
            context.fillText(`${sentimentText} (${stock.sentiment.sources})`, 150, 78);
            
            const labelTexture = new THREE.CanvasTexture(canvas);
            const labelGeometry = new THREE.PlaneGeometry(10, 3.3);
            const labelMaterial = new THREE.MeshBasicMaterial({
                map: labelTexture,
                transparent: true,
                opacity: 0.9
            });
            
            const label = new THREE.Mesh(labelGeometry, labelMaterial);
            label.position.copy(position);
            label.position.y += 10;
            label.lookAt(camera.position);
            
            scene.add(label);
            return label;
        }

        // Initialize visualization
        stocks.forEach((stock, i) => {
            const cluster = createStockCluster(stock, i);
            clusters.push(cluster);
            
            const label = createStockLabel(stock, cluster.position);
            labels.push(label);
        });

        // Add enhanced lighting
        const ambientLight = new THREE.AmbientLight(0x004444, 0.4);
        scene.add(ambientLight);

        // Simulate live data updates
        // Simulate live data updates
function updateMarketData() {
    allStocks.forEach(stock => {
        // Simulate price changes
        const priceChange = (Math.random() - 0.5) * 0.5;
        stock.change += priceChange;
        stock.price *= (1 + priceChange / 100);
        
        // Simulate sentiment changes
        stock.sentiment.score += (Math.random() - 0.5) * 0.2;
        stock.sentiment.score = Math.max(-1, Math.min(1, stock.sentiment.score));
        stock.sentiment.sources += Math.floor((Math.random() - 0.5) * 5);
        stock.sentiment.sources = Math.max(1, stock.sentiment.sources);
        
        // Update volatility
        stock.volatility += (Math.random() - 0.5) * 0.1;
        stock.volatility = Math.max(0.1, Math.min(1, stock.volatility));
    });
    
    // Update active stocks reference
    stocks = getActiveStocks();
    
    // Update global metrics
    marketData.overallSentiment = stocks.reduce((sum, s) => sum + s.sentiment.score, 0) / Math.max(stocks.length, 1);
    marketData.riskLevel = stocks.reduce((sum, s) => sum + s.volatility, 0) / Math.max(stocks.length, 1);
    marketData.lastUpdate = new Date();
    
    updateUI();
    if (stocks.length > 0) {
        recreateVisualization();
    }
}


        // UI Updates
        function updateUI() {
            const sentimentEl = document.getElementById('sentimentValue');
            const riskEl = document.getElementById('riskLevel');
            
            if (marketData.overallSentiment > 0.3) {
                sentimentEl.textContent = 'BULLISH';
                sentimentEl.style.color = '#00ff44';
            } else if (marketData.overallSentiment < -0.3) {
                sentimentEl.textContent = 'BEARISH';
                sentimentEl.style.color = '#ff4400';
            } else {
                sentimentEl.textContent = 'NEUTRAL';
                sentimentEl.style.color = '#ffaa00';
            }
            
            if (marketData.riskLevel > 0.7) {
                riskEl.textContent = 'HIGH';
                riskEl.style.color = '#ff4400';
            } else if (marketData.riskLevel > 0.4) {
                riskEl.textContent = 'MODERATE';
                riskEl.style.color = '#ffaa00';
            } else {
                riskEl.textContent = 'LOW';
                riskEl.style.color = '#00ff44';
            }
            
            // Update market stats
            document.getElementById('marketStats').innerHTML = `
                <div class="data-row"><span>Overall Sentiment:</span><span>${marketData.overallSentiment.toFixed(2)}</span></div>
                <div class="data-row"><span>Volatility Index:</span><span>${marketData.riskLevel.toFixed(2)}</span></div>
                <div class="data-row"><span>News Volume:</span><span>${marketData.newsVolume}</span></div>
                <div class="data-row"><span>Social Mentions:</span><span>${marketData.socialMentions}</span></div>
                <div class="data-row"><span>Last Update:</span><span>${marketData.lastUpdate.toLocaleTimeString()}</span></div>
            `;
            
            // Update sentiment feed
            const feed = document.getElementById('sentimentFeed');
            const newItem = document.createElement('div');
            newItem.style.fontSize = '10px';
            newItem.style.marginBottom = '3px';
            newItem.innerHTML = `${new Date().toLocaleTimeString()}: Market sentiment ${marketData.overallSentiment > 0 ? 'improving' : 'declining'}`;
            feed.insertBefore(newItem, feed.firstChild);
            
            // Keep only last 10 items
            while (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }

        function recreateVisualization() {
            // Clear existing objects
            clusters.forEach(cluster => scene.remove(cluster));
            labels.forEach(label => scene.remove(label));
            pulseRings.forEach(ring => scene.remove(ring.ring));
            
            clusters.length = 0;
            labels.length = 0;
            pulseRings.length = 0;
            
            // Recreate with updated data
            stocks.forEach((stock, i) => {
                const cluster = createStockCluster(stock, i);
                clusters.push(cluster);
                
                const label = createStockLabel(stock, cluster.position);
                labels.push(label);
            });
        }

        // Mouse interaction
        document.addEventListener('mousemove', function(event) {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
            
            mouse.x = mouseX;
            mouse.y = mouseY;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clusters);
            
            if (intersects.length > 0) {
                const stock = intersects[0].object.userData.stock;
                const sentimentClass = stock.sentiment.score > 0 ? 'positive' : 
                                     stock.sentiment.score < 0 ? 'negative' : 'neutral';
                                     
                tooltip.innerHTML = `
                    <div style="font-size: 16px; margin-bottom: 6px; display: flex; align-items: center;">
                        <span class="sentiment-indicator ${sentimentClass}"></span>${stock.name}
                    </div>
                    <div>Price: $${stock.price.toFixed(2)}</div>
                    <div>Change: ${stock.change > 0 ? '+' : ''}${stock.change.toFixed(2)}%</div>
                    <div>Volume: ${stock.volume}</div>
                    <div>Sentiment: ${stock.sentiment.score.toFixed(2)} (${stock.sentiment.sources} sources)</div>
                    <div>Volatility: ${(stock.volatility * 100).toFixed(0)}%</div>
                    <div>News Articles: ${stock.newsCount}</div>
                `;
                tooltip.style.display = 'block';
                tooltip.style.left = (event.clientX + 15) + 'px';
                tooltip.style.top = (event.clientY - 80) + 'px';
            } else {
                tooltip.style.display = 'none';
            }
        });

        document.addEventListener('click', function() {
            isRotating = !isRotating;
        });

        // Panel Management Functions
function renderStockPanel() {
    const stockList = document.getElementById('stockList');
    stockList.innerHTML = '';
    
    allStocks.forEach(stock => {
        const stockItem = document.createElement('div');
        stockItem.className = `stock-item ${stock.active ? 'active' : ''}`;
        
        const sentimentClass = stock.sentiment.score > 0 ? 'positive' : 
                             stock.sentiment.score < 0 ? 'negative' : 'neutral';
        
        stockItem.innerHTML = `
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; margin-bottom: 4px;">
                    <span class="sentiment-indicator ${sentimentClass}"></span>
                    <strong>${stock.name}</strong>
                    <span style="margin-left: 10px; font-size: 12px; color: rgba(0,255,255,0.7);">
                        ${stock.change > 0 ? '+' : ''}${stock.change.toFixed(1)}%
                    </span>
                </div>
                <div class="stock-info">
                    $${stock.price.toFixed(2)} ‚Ä¢ Vol: ${stock.volume} ‚Ä¢ Sent: ${stock.sentiment.score.toFixed(2)}
                </div>
            </div>
            <div class="stock-toggle ${stock.active ? 'checked' : ''}" data-symbol="${stock.name}"></div>
        `;
        
        stockList.appendChild(stockItem);
    });
    
    // Add event listeners to toggles
    document.querySelectorAll('.stock-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
            const symbol = this.dataset.symbol;
            const stock = allStocks.find(s => s.name === symbol);
            if (stock) {
                stock.active = !stock.active;
                renderStockPanel();
                
                // Update visualization
                stocks = getActiveStocks();
                if (stocks.length > 0) {
                    recreateVisualization();
                } else {
                    // Clear scene if no stocks active
                    clearVisualization();
                }
                updateUI();
            }
        });
    });
}

function clearVisualization() {
    clusters.forEach(cluster => scene.remove(cluster));
    labels.forEach(label => scene.remove(label));
    pulseRings.forEach(ring => scene.remove(ring.ring));
    
    clusters.length = 0;
    labels.length = 0;
    pulseRings.length = 0;
}

function addNewStock(symbol) {
    symbol = symbol.toUpperCase().trim();
    
    if (!symbol || symbol.length > 5) {
        alert('Please enter a valid stock symbol (1-5 characters)');
        return;
    }
    
    if (allStocks.find(s => s.name === symbol)) {
        alert('Stock already exists in the list');
        return;
    }
    
    // Create new stock with simulated data
    const newStock = {
        name: symbol,
        change: (Math.random() - 0.5) * 6, // -3% to +3%
        price: Math.random() * 500 + 50, // $50 to $550
        volume: (Math.random() * 100 + 10).toFixed(1) + 'M',
        sentiment: {
            score: (Math.random() - 0.5) * 1.8, // -0.9 to +0.9
            sources: Math.floor(Math.random() * 30) + 5,
            trend: 'neutral'
        },
        volatility: Math.random() * 0.8 + 0.1, // 0.1 to 0.9
        newsCount: Math.floor(Math.random() * 25) + 1,
        active: true
    };
    
    // Set trend based on sentiment score
    if (newStock.sentiment.score > 0.5) {
        newStock.sentiment.trend = 'very_bullish';
    } else if (newStock.sentiment.score > 0) {
        newStock.sentiment.trend = 'bullish';
    } else if (newStock.sentiment.score > -0.5) {
        newStock.sentiment.trend = 'neutral';
    } else {
        newStock.sentiment.trend = 'bearish';
    }
    
    allStocks.push(newStock);
    renderStockPanel();
    
    // Update visualization
    stocks = getActiveStocks();
    recreateVisualization();
    updateUI();
    
    // Clear input
    document.getElementById('newStockSymbol').value = '';
}

        // Animation loop with enhanced effects
        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;
            
            // Animate particles with sentiment-based pulsing
            clusters.forEach((cluster, index) => {
                const positions = cluster.geometry.attributes.position.array;
                const originalPositions = cluster.userData.originalPositions;
                const pulseIntensity = cluster.userData.pulseIntensity;
                const stock = cluster.userData.stock;
                
                // Create pulsing effect based on volatility and sentiment
                const pulseSpeed = 0.01 + pulseIntensity * 0.02;
                const pulseAmplitude = 0.3 + pulseIntensity * 0.7;
                
                for (let i = 0; i < positions.length; i += 3) {
                    const pulse = Math.sin(time * pulseSpeed + index + i * 0.01) * pulseAmplitude;
                    positions[i] = originalPositions[i] + pulse * 0.5;
                    positions[i + 1] = originalPositions[i + 1] + Math.cos(time * pulseSpeed + index + i * 0.01) * pulseAmplitude * 0.3;
                    positions[i + 2] = originalPositions[i + 2] + pulse * 0.4;
                }
                
                cluster.geometry.attributes.position.needsUpdate = true;
                cluster.rotation.y += 0.005 + pulseIntensity * 0.01;
                cluster.rotation.x = Math.sin(time + index) * 0.1;
                
                // Animate opacity based on sentiment confidence
                cluster.material.opacity = 0.7 + Math.abs(stock.sentiment.score) * 0.3 + Math.sin(time * 2) * 0.1;
            });
            
            // Animate pulse rings
            pulseRings.forEach(ringData => {
                ringData.ring.scale.x = 1 + Math.sin(time * 3) * 0.3 * ringData.intensity;
                ringData.ring.scale.y = 1 + Math.sin(time * 3) * 0.3 * ringData.intensity;
                ringData.ring.material.opacity = 0.3 + Math.sin(time * 2) * 0.2;
            });
            
            // Update label rotations
            labels.forEach(label => {
                label.lookAt(camera.position);
            });
            
            if (isRotating) {
                const globalPulse = 1 + Math.sin(time * 0.5) * 0.1 * marketData.riskLevel;
                scene.rotation.y = mouseX * 0.3 + time * 0.1 * globalPulse;
                scene.rotation.x = mouseY * 0.2 + Math.sin(time * 0.7) * 0.1;
            }
            
            renderer.render(scene, camera);
        }

        // Resize handler
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Initialize
renderStockPanel();
updateUI();
animate();

// Panel Controls
document.getElementById('togglePanel').addEventListener('click', function() {
    const panel = document.getElementById('stockPanel');
    panel.classList.toggle('open');
});

document.getElementById('addStockBtn').addEventListener('click', function() {
    const symbol = document.getElementById('newStockSymbol').value;
    addNewStock(symbol);
});

document.getElementById('newStockSymbol').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        addNewStock(this.value);
    }
});

document.getElementById('selectAllBtn').addEventListener('click', function() {
    allStocks.forEach(stock => stock.active = true);
    renderStockPanel();
    stocks = getActiveStocks();
    recreateVisualization();
    updateUI();
});

document.getElementById('deselectAllBtn').addEventListener('click', function() {
    allStocks.forEach(stock => stock.active = false);
    renderStockPanel();
    stocks = getActiveStocks();
    clearVisualization();
    updateUI();
});

// Start live updates (every 10 seconds for demo)
setInterval(updateMarketData, 10000);
        
        // Initial market analysis simulation
        setTimeout(() => {
            document.getElementById('sentimentFeed').innerHTML = `
                <div style="font-size: 10px; margin-bottom: 3px;">System initialized - analyzing 8 stocks</div>
                <div style="font-size: 10px; margin-bottom: 3px;">Sentiment analysis: Mixed signals detected</div>
                <div style="font-size: 10px; margin-bottom: 3px;">High volatility in TSLA and NVDA</div>
                <div style="font-size: 10px; margin-bottom: 3px;">Social sentiment trending positive for tech</div>
            `;
        }, 2000);
    </script>
</body>
</html>
